<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="style.css" rel="stylesheet">
    <link rel="icon" href="images/icon.ico" type="image/x-icon">
    <title>Map Maker | HELLDIVERS: Mess Hall</title>
</head>
<body>
    <div class="header"><a href="index.html"><img src="images/title_yellow.png"></a></div>
    <div class="content">
        <div class="half">
            <div class="contentgroup_vertical" style="z-index:1">
                <div class="contentcontainer" id="settingheader">
                    <p><u>Enemies</u></p>
                    <p><u>Biome</u></p>
                    <p><u>Colonization</u></p>
                    <p><u>Terrain</u></p>
                </div>
                <div class="contentcontainer" id="settings">
                    <drop-down id="enemy" style="z-index: 3;">
                        <drop-option value="terminid"><p>Terminids</p></drop-option>
                        <drop-option value="automaton"><p>Automatons</p></drop-option>
                        <drop-option value="illuminate"><p>Illuminate</p></drop-option>
                    </drop-down>
                    <drop-down id="biome" style="z-index: 2">
                        <drop-option value="0"><p>Plains</p></drop-option> 
                        <drop-option value="1"><p>Tundra</p></drop-option>
                        <drop-option value="2"><p>Jungle</p></drop-option>
                        <drop-option value="3"><p>Swamp</p></drop-option>
                        <drop-option value="4"><p>Desert</p></drop-option>
                        <drop-option value="5"><p>Canyons</p></drop-option>
                        <drop-option value="6"><p>Ethereal</p></drop-option>
                        <drop-option value="7"><p>Ionic</p></drop-option>
                        <drop-option value="8"><p>Glacier</p></drop-option>
                        <drop-option value="9"><p>Boneyard</p></drop-option>
                        <drop-option value="10"><p>Badlands</p></drop-option>
                        <drop-option value="11"><p>Moon</p></drop-option>
                    </drop-down>
                    <drop-down id="colonization" style="z-index: 1">
                        <drop-option><p>< WIP ></p></drop-option>
                        <!--drop-option><p>Untouched</p></drop-option>
                        <drop-option><p>Abandoned</p></drop-option>
                        <drop-option><p>Colony</p></drop-option>
                        <drop-option><p>Metropolis</p></drop-option-->
                    </drop-down>
                    <drop-down id="terrain" style="z-index: 0">
                        <drop-option><p>< WIP ></p></drop-option>
                        <!--drop-option><p>Flat</p></drop-option>
                        <drop-option><p>Moderate</p></drop-option>
                        <drop-option><p>Rough</p></drop-option-->
                    </drop-down> 
                </div>
            </div>
            <div class="contentgroup_horizontal">
                <div class="contentcontainer" id="markers" style="z-index: 1">
                    <button onclick="setMarkers()" id="generate">Generate</button>
                    <div style="z-index: 5">
                        <drop-down id="misc">
                            <drop-option><img src="images/icons/Misc/Extraction 1.webp"><p>Extraction Point</p></drop-option>
                            <drop-option><img src="images/icons/Misc/POI 1.webp"><p>Minor POI (Undiscovered)</p></drop-option>
                            <drop-option><img src="images/icons/Misc/POI 2.webp"><p>Minor POI (Discovered)</p></drop-option>
                        </drop-down>
                        <button onclick="addMarker('misc')" id="button_misc"><img src="images/icons/add.webp"></button>
                    </div>
                    <div style="z-index: 4">
                        <drop-down id="outposts">
                            <drop-option></drop-option>
                        </drop-down>
                        <button onclick="addMarker('outposts')" id="button_outposts"><img src="images/icons/add.webp"></button>
                    </div>
                    <div style="z-index: 3">
                        <drop-down id="mainobjs_generic">
                            <drop-option><img src="images/icons/main/Generic/Terminate Illegal Broadcast.webp"><p>Terminate Illegal Broadcast</p></drop-option>
                            <drop-option><img src="images/icons/main/Generic/Pump Fuel To ICBM.webp"><p>Pump Fuel To ICBM</p></drop-option>
                            <drop-option><img src="images/icons/main/Generic/Upload Escape Pod Data.webp"><p>Upload Escape Pod Data</p></drop-option>
                            <drop-option><img src="images/icons/main/Generic/Spread Democracy.webp"><p>Spread Democracy</p></drop-option>
                            <drop-option><img src="images/icons/main/Generic/Conduct Geological Survey.webp"><p>Conduct Geological Survey</p></drop-option>
                            <drop-option><img src="images/icons/main/Generic/Launch ICBM.webp"><p>Launch ICBM</p></drop-option>
                            <drop-option><img src="images/icons/main/Generic/Retrieve Valuable Data.webp"><p>Retrieve Valuable Data</p></drop-option>
                            <drop-option><img src="images/icons/main/Generic/Emergency Evacuation.webp"><p>Emergency Evacuation</p></drop-option>
                            <drop-option><img src="images/icons/main/Generic/Retrieve Essential Personnel.webp"><p>Retrieve Essential Personnel</p></drop-option>
                            <drop-option><img src="images/icons/main/Generic/Evacuate High-Value Assets.webp"><p>Evacuate High-Value Assets</p></drop-option>
                        </drop-down>
                        <button onclick="addMarker('mainobjs_generic')" id="button_mainobjs_generic"><img src="images/icons/add.webp"></button>
                    </div>
                    <div style="z-index: 2">
                        <drop-down id="mainobjs_faction">
                            <drop-option></drop-option>
                        </drop-down>
                        <button onclick="addMarker('mainobjs_faction')" id="button_mainobjs_faction"><img src="images/icons/add.webp"></button>
                    </div>
                    <div style="z-index: 1">
                        <drop-down id="sideobjs_generic">
                            <drop-option><img src="images/icons/side/Generic/SEAF Artillery.webp"><p>SEAF Artillery</p></drop-option>
                            <drop-option><img src="images/icons/side/Generic/Radar Station.webp"><p>Radar Station</p></drop-option>
                            <drop-option><img src="images/icons/side/Generic/SEAF SAM Site.webp"><p>SEAF SAM Site</p></drop-option>
                            <drop-option><img src="images/icons/side/Generic/Upload Escape Pod Data.webp"><p>Upload Escape Pod Data</p></drop-option>
                            <drop-option><img src="images/icons/side/Generic/Destroy Rogue Research Station.webp"><p>Destroy Rogue Research Station</p></drop-option>
                            <drop-option><img src="images/icons/side/Generic/Terminate Illegal Broadcast.webp"><p>Terminate Illegal Broadcast</p></drop-option>
                        </drop-down>
                        <button onclick="addMarker('sideobjs_generic')" id="button_sideobjs_generic"><img src="images/icons/add.webp"></button>
                    </div>
                    <div style="z-index: 0">
                        <drop-down id="sideobjs_faction">
                            <drop-option></drop-option>
                        </drop-down>
                        <button onclick="addMarker('sideobjs_faction')" id="button_sideobjs_faction"><img src="images/icons/add.webp"></button>
                    </div>
                </div>
                <div class="contentcontainer" id="map">
                </div>
            </div>
        </div>
        <!--div class="half">
            <div class="contentcontainer" id="info">
                <h3>Mission Info</h3>
                <span id="info_enemy"><p>Enemies in this region:  </p> <p>Terminids</p> <img src="images/icons/terminid.webp"></span>
            </div>
            <div class="contentcontainer" id="missions">
                <p>missions</p>
            </div>
        </div-->
    </div>
</body>
</html>
<style>
    .content {
        --mapsize: 500px;
        display: flex;
        flex-direction: row;
    }
    @media (min-width: 1000px) {.half {
        display: flex;
        flex-wrap: wrap;
        width: 49%;
    }}
    @media (max-width: 1000px) {.half {
        display: flex;
        flex-wrap: wrap;
        width: 100%;
    }}
    
    .contentgroup_vertical {
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: flex-start;
        --fullsize: calc(var(--mapsize) + 150px);
        width: var(--fullsize);

    }
    .contentgroup_horizontal {
        display: flex;
        flex-direction: row;
        align-items: flex-start;
        width: calc(var(--mapsize) + 170px);

    }
    .contentcontainer {
        padding: 0;
        margin: 0;
        &#settingheader {
            width: 100%;
            margin-bottom: 0;
            display: flex;
            justify-content:center;
            align-items: center;
            p {
                width: calc(var(--fullsize) / 4);
                justify-content: center;
                text-align: center;
                border-left: solid 1px #eeed;
                border-right: solid 1px #eeed;
                border-bottom: solid 1px #eeed;
                padding: 10px 0;
                font-size: 25px;
                font-weight: 500;
            }
        }
        &#settings {
            width: 100%;
            margin-top: 0;
            margin-bottom: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            
            drop-down {
                display: inline-block;
                width: calc(var(--fullsize) / 4);
                border-left: solid 1px #eeed;
                border-right: solid 1px #eeed;
                --height: 50px;
                --fontsize: 0.45;
                --bgcolor: none;
                
                .selected p {
                    width: 100%;
                    justify-content: center;
                    align-items: center;
                    display: flex;
                    height: 100%;
                    
                }
                .options {
                    background-color: #221e;
                    justify-content: center;
                    align-items: center;
                    width: auto;

                    drop-option {
                        padding: 0 10px;
                        width: 100%;
                    }
                }
            }

        }
        &#markers {
            width: 140px;
            height: var(--mapsize);
            padding: 20px 10px;
            margin: 0;
            margin-right: 10px;
            align-items: center;
            justify-content: center;

            >button {
                background-color: black;
                color: yellow;
                border: solid 1px yellow;
                text-align: center;
                justify-content: center;
                margin: auto;
                margin-bottom: 10px;
                width: 100px;
                height: 40px;

                &:hover {
                    font-weight: 500;
                    border: solid 2px yellow;
                }
                &:active {
                    background-color: yellow;
                    color: black;
                    border: solid 1px black;
                }
            }

            >div {
                display: flex;
                flex-direction: row;
                margin-bottom: 5px;

                drop-down {
                    --height: 60px;
                    --fontsize: 0.4;
                    --bgcolor: none;
                    z-index: 1;
                    width: 60px;
                    padding: 0;
                    .selected {
                        padding: 0;
                        p {
                            display: none;
                        }
                        img {
                            padding: 2px;
                        }
                    }
                    .options {
                        background-color: #221e;
                        width: max-content;
                        drop-option {
                            padding: 2px 5px;
                            height: 54px;

                            p {
                                padding: 5px 10px;
                            }
                            img {
                                padding: 2px;
                            }
                        }
                    }
                }

                button {
                    display: none;
                    z-index: 0;
                    width: 60px;
                    height: 60px;
                    background: none;
                    padding: 0;
                    border: solid 1px #0000;
                    justify-content: center;
                    img {
                        width: 80%;
                        height: 80%;
                        margin: auto;
                    }
                    &:hover {
                        border: solid 1px #fff500;
                        img {
                            width: 90%;
                            height: 90%;
                        }
                    }
                    &:active {
                        background-color: #fff500;
                        img {
                            width: 90%;
                            height: 90%;
                        }
                    }
                }
            }
        }
        &#map {
            width: var(--mapsize);
            height: var(--mapsize);
        }
        &#info, &#missions {
            width: 100%;
            height: 100px;
            justify-content: baseline;

            span {
                display: flex;
                --height: 20px;
                height: var(--height);
                font-size: var(--height);
                vertical-align: middle;
                * {
                    align-content: baseline;
                    display: inline-block;
                    font-size: calc(var(--height) * 0.8);

                }
                img {
                    width: var(--height);
                    height: var(--height);
                    
                }
            }
        }
    }
    
</style>
<script src="dropdown_custom.js"></script>
<script src="https://unpkg.com/konva@9/konva.min.js"></script>
<script>
    
    const mapSize = 500;

    function AddImage(layer, image, w=mapSize, h=mapSize, onload=null) {
        var img = new Image();
        img.onload = function() {
            var k = new Konva.Image({image:img, width:w, height:h});
            layer.add(k);
            if (onload != null) onload(k);
        }
        img.src = image;
    }

    const stage = new Konva.Stage({container: 'map', width: mapSize, height: mapSize});

    const layer_bg = new Konva.Layer();
    stage.add(layer_bg);
    const layer_grid = new Konva.Layer();
    stage.add(layer_grid);
    const layer_map = new Konva.Layer();
    stage.add(layer_map);
    
    AddImage(layer_bg, "images/minimap.webp");
    AddImage(layer_bg, "images/mask.webp");

    const tempcanvas = document.createElement('canvas');
    tempcanvas.width = mapSize;
    tempcanvas.height = mapSize;
    const tempctx = tempcanvas.getContext('2d')

    const mask = new Image();
    mask.src = "images/mask.webp";
    
    const dropO = document.getElementById('outposts');
    const dropM = document.getElementById('mainobjs_faction');
    const dropS = document.getElementById('sideobjs_faction');

    const bugsO = `
        <drop-option><img src="images/icons/Outposts/terminid_small.webp"><p>Small Nest</p></drop-option>
        <drop-option><img src="images/icons/Outposts/terminid_medium.webp"><p>Medium Nest</p></drop-option>
        <drop-option><img src="images/icons/Outposts/terminid_heavy.webp"><p>Heavy Nest</p></drop-option>
        <drop-option><img src="images/icons/Outposts/terminid_mega.webp"><p>Meganest</p></drop-option>
    `
    const botsO = `
        <drop-option><img src="images/icons/Outposts/automaton_small.webp"><p>Small Outpost</p></drop-option>
        <drop-option><img src="images/icons/Outposts/automaton_medium.webp"><p>Medium Outpost</p></drop-option>
        <drop-option><img src="images/icons/Outposts/automaton_heavy.webp"><p>Heavy Outpost</p></drop-option>
        <drop-option><img src="images/icons/Outposts/automaton_mega.webp"><p>Fortress</p></drop-option>
    `
    const squidsO = `
        <drop-option><img src="images/icons/Outposts/illuminate_small.webp"><p>Small Encampment</p></drop-option>
        <drop-option><img src="images/icons/Outposts/illuminate_medium.webp"><p>Medium Encampment</p></drop-option>
        <drop-option><img src="images/icons/Outposts/illuminate_heavy.webp"><p>Heavy Encampment</p></drop-option>
        <drop-option><img src="images/icons/Outposts/illuminate_mega.webp"><p>Great Fleet</p></drop-option>
    `
    const bugsM = `    
        <drop-option><img src="images/icons/main/terminid/Eradicate Terminid Swarm.webp"><p>Eradicate terminid Swarm</p></drop-option>
        <drop-option><img src="images/icons/main/terminid/Eliminate Brood Commanders.webp"><p>Eliminate Brood Commanders</p></drop-option>
        <drop-option><img src="images/icons/main/terminid/Eliminate Chargers.webp"><p>Eliminate Chargers</p></drop-option>
        <drop-option><img src="images/icons/main/terminid/Eliminate Impaler.webp"><p>Eliminate Impaler</p></drop-option>
        <drop-option><img src="images/icons/main/terminid/Eliminate Bile Titans.webp"><p>Eliminate Bile Titans</p></drop-option>
        <drop-option><img src="images/icons/main/terminid/Activate E-710 Pumps.webp"><p>Activate E-710 Pumps</p></drop-option>
        <drop-option><img src="images/icons/main/terminid/Purge Hatcheries.webp"><p>Purge Hatcheries</p></drop-option>
        <drop-option><img src="images/icons/main/terminid/Enable E-710 Extraction.webp"><p>Enable E-710 Extraction</p></drop-option>
        <drop-option><img src="images/icons/main/terminid/Nuke Nursery.webp"><p>Nuke Nursery</p></drop-option>
        <drop-option><img src="images/icons/main/terminid/Blitz - Destroy Nests.webp"><p>Blitz - Destroy Nests</p></drop-option>                
    `
    const botsM = `
        <drop-option><img src="images/icons/main/automaton/Eradicate Automaton Forces.webp"><p>Eradicate Automaton Forces</p></drop-option>
        <drop-option><img src="images/icons/main/automaton/Destroy Transmission Network.webp"><p>Destroy Transmission Network</p></drop-option>
        <drop-option><img src="images/icons/main/automaton/Eliminate Devastators.webp"><p>Eliminate Devastators</p></drop-option>
        <drop-option><img src="images/icons/main/automaton/Eliminate Hulks.webp"><p>Eliminate Hulks</p></drop-option>
        <drop-option><img src="images/icons/main/automaton/Eliminate Factory Strider.webp"><p>Eliminate Factory Strider</p></drop-option>
        <drop-option><img src="images/icons/main/automaton/Sabotage Supply Bases.webp"><p>Sabotage Supply Bases</p></drop-option>
        <drop-option><img src="images/icons/main/automaton/Sabotage Air Ships.webp"><p>Sabotage Air Ships</p></drop-option>
        <drop-option><img src="images/icons/main/automaton/Sabotage Air Base.webp"><p>Sabotage Air Base</p></drop-option>
        <drop-option><img src="images/icons/main/automaton/Destroy Command Bunkers.webp"><p>Destroy Command Bunkers</p></drop-option>
        <drop-option><img src="images/icons/main/automaton/Neutralize Orbital Defenses.webp"><p>Neutralize Orbital Defenses</p></drop-option>
        <drop-option><img src="images/icons/main/automaton/Blitz - Destroy Fabricators.webp"><p>Blitz - Destroy Fabricators</p></drop-option>
    `
    const squidsM = `
        <drop-option><img src="images/icons/main/illuminate/Purge Illuminate.webp"><p>Purge Illuminate</p></drop-option>
        <drop-option><img src="images/icons/main/illuminate/Evacuate Colonists.webp"><p>Evacuate Colonists</p></drop-option>
        <drop-option><img src="images/icons/main/illuminate/Retrieve Recon Craft Intel.webp"><p>Retrieve Recon Craft Intel</p></drop-option>
        <drop-option><img src="images/icons/main/illuminate/Free Colony.webp"><p>Free Colony</p></drop-option>
        <drop-option><img src="images/icons/main/illuminate/Destroy Harvesters.webp"><p>Destroy Harvesters</p></drop-option>
        <drop-option><img src="images/icons/main/illuminate/Repel Invasion Fleet.webp"><p>Repel Invasion Fleet</p></drop-option>
        <drop-option><img src="images/icons/main/illuminate/Take Down Overship.webp"><p>Take Down Overship</p></drop-option>
        <drop-option><img src="images/icons/main/illuminate/Blitz - Destroy Warp Ships.webp"><p>Blitz - Destroy Warp Ships</p></drop-option>
    `
    const bugsS = `    
        <drop-option><img src="images/icons/side/terminid/Spore Spewer.webp"><p>Spore Spewer</p></drop-option>
        <drop-option><img src="images/icons/side/terminid/Stalker Lair.webp"><p>Stalker Lair</p></drop-option>
        <drop-option><img src="images/icons/side/terminid/Shrieker Nest.webp"><p>Shrieker Nest</p></drop-option>
        <drop-option><img src="images/icons/side/terminid/Retrieve Mutant Larva.webp"><p>Retrieve Mutant Larva</p></drop-option>              
    `
    const botsS = `
        <drop-option><img src="images/icons/side/automaton/Detector Tower.webp"><p>Detector Tower</p></drop-option>
        <drop-option><img src="images/icons/side/automaton/Mortar Emplacement.webp"><p>Mortar Emplacement</p></drop-option>
        <drop-option><img src="images/icons/side/automaton/Stratagem Jammer.webp"><p>Stratagem Jammer</p></drop-option>
        <drop-option><img src="images/icons/side/automaton/Anti-Air Emplacement.webp"><p>Anti-Air Emplacement</p></drop-option>
        <drop-option><img src="images/icons/side/automaton/Gunship Facility.webp"><p>Gunship Facility</p></drop-option>
        <drop-option><img src="images/icons/side/automaton/Intercept Convoy.webp"><p>Intercept Convoy</p></drop-option>
        <drop-option><img src="images/icons/side/automaton/Enemy Bio-Processors.webp"><p>Enemy Bio-Processors</p></drop-option>
    `
    const squidsS = `
        <drop-option><img src="images/icons/side/illuminate/Cognitive Disruptor.webp"><p>Cognitive Disruptor</p></drop-option>
    `

    const started = false;

    function setMarkers() {
        var enemy = document.getElementById('enemy').selected.value;
        if (enemy == 'terminid') {
            dropO.optdiv.innerHTML = bugsO;
            dropM.optdiv.innerHTML = bugsM;
            dropS.optdiv.innerHTML = bugsS;
        } else if (enemy == 'automaton') {
            dropO.optdiv.innerHTML = botsO;
            dropM.optdiv.innerHTML = botsM;
            dropS.optdiv.innerHTML = botsS;
        } else if (enemy == 'illuminate') {
            dropO.optdiv.innerHTML = squidsO;
            dropM.optdiv.innerHTML = squidsM;
            dropS.optdiv.innerHTML = squidsS;
        }
        dropO.updateOptions();
        dropM.updateOptions();
        dropS.updateOptions();

        if (started) return;

        var divs = document.getElementById('markers').children;
        for (var div of divs) {
            if (div == divs[0]) continue;
            
            var query = div.querySelectorAll('button');
            query[0].style.display = "block";
        }
    }
    const markerSize = 60;
    var markers = [];
    var shadows = [];

    function addMarker(id) {
        var drop = document.getElementById(id);
        var src = drop.selected.children[0].src;
        
        AddImage(layer_map, src, markerSize, markerSize, function(img) {
            img.draggable(true);
            markers.push(img);
            AddImage(layer_map, "images/icons/shadow.webp", markerSize, markerSize, function(shadow) {
                shadow.moveToBottom();
                shadows.push(shadow);
            });
            img.on('dragmove', () => {
                var end = mapSize - markerSize;
                if (img.x() <= 0) img.x(0);
                if (img.y() <= 0) img.y(0);
                if (img.x() >= end) img.x(end);
                if (img.y() >= end) img.y(end);

                var shadow = shadows[markers.indexOf(img)];
                shadow.x(img.x());
                shadow.y(img.y());
            });
        });
    }
    
</script>
<script type="module">
    import {drawMap} from "./mapgenerator.js";
    
    const biomes = [
        "rgb(54, 67, 35)",
        "rgb(60, 78, 42)",
        "rgb(30, 60, 30)",
        "rgb(41, 54, 25)",
        "rgb(74, 61, 29)",
        "rgb(74, 54, 35)",
        "rgb(88, 48, 96)",
        "rgb(32, 64, 96)",
        "rgb(70, 84, 90)",
        "rgb(61, 61, 61)",
        "rgb(96, 104, 8)",
        "rgb(48, 49, 54)"
    ]

    function GenerateMap() {
        layer_grid.clear();
        tempctx.clearRect(0, 0, mapSize, mapSize);
        var biome = document.getElementById('biome').selected.value;

        tempctx.drawImage(mask, 0, 0, mapSize, mapSize);
        tempctx.globalCompositeOperation = 'source-in';
        //drawMap(tempctx);
        tempctx.fillStyle = biomes[biome];
        tempctx.fillRect(0, 0, mapSize, mapSize);
        tempctx.globalCompositeOperation = 'source-over';

        const generation = new Konva.Image({image:tempcanvas, width:mapSize, height:mapSize});
        layer_grid.add(generation);
        AddImage(layer_grid, "images/map 1000m grid.webp");
    }

    document.getElementById('generate').addEventListener('click', GenerateMap);

</script>